require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/order_details/index"],{"0c2b":function(t,e,o){"use strict";(function(t,e){var i=o("47a9");o("f076");i(o("3240"));var n=i(o("64d8"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(n.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"37f6":function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return n})),o.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,o=(t._self._c,[1,3].includes(t.orderInfo.shipping_type)&&0==t.orderInfo.product_type),i=2===t.orderInfo.shipping_type&&[0,4].includes(t.orderInfo.product_type),n=[5,1,2,3].includes(t.status.type)&&(2==t.orderInfo.shipping_type||"send"==t.orderInfo.delivery_type||4==t.orderInfo.product_type),r=t.__map(t.cartInfo,(function(e,o){var i=t.__get_orig(e),r=n&&!e.is_writeoff&&e.write_surplus_times<e.write_times?parseInt(e.write_times):null,s=n&&!e.is_writeoff&&e.write_surplus_times<e.write_times?parseInt(e.write_surplus_times):null,a=t.orderInfo.is_apply_refund&&0===t.orderInfo.refund_status&&e.refund_num!=e.cart_num&&Number(t.orderInfo.paid)&&e.is_support_refund&&8!=t.orderInfo.type;return{$orig:i,m0:r,m1:s,m2:a}})),s=t.giftCount>0?t.giveData.give_coupon.length:null,a=1==t.orderInfo.product_type&&Array.isArray(t.orderInfo.virtual_info),d=(parseFloat(t.orderInfo.total_price)+parseFloat(t.orderInfo.vip_true_price)).toFixed(2),c=t.orderInfo.pay_postage>0?parseFloat(t.orderInfo.pay_postage).toFixed(2):null,u=t.orderInfo.vip_true_price>0?parseFloat(t.orderInfo.vip_true_price).toFixed(2):null,l=t.orderInfo.first_order_price>0?parseFloat(t.orderInfo.first_order_price).toFixed(2):null,f=t.orderInfo.coupon_id?parseFloat(t.orderInfo.coupon_price).toFixed(2):null,h=t.orderInfo.use_integral>0?parseFloat(t.orderInfo.deduction_price).toFixed(2):null,p=t.__map(t.orderInfo.promotions_detail,(function(e,o){var i=t.__get_orig(e),n=parseFloat(e.promotions_price),r=parseFloat(e.promotions_price).toFixed(2);return{$orig:i,m3:n,g11:r}})),_=parseFloat(t.orderInfo.pay_price).toFixed(2),g=t.orderInfo.custom_form&&t.orderInfo.custom_form.length,v=g?t.__map(t.orderInfo.custom_form,(function(e,o){var i=t.__get_orig(e),n="uploadPicture"==e.name&&e.value.length<5,r=n?null:"uploadPicture"==e.name&&e.value.length>=5,s=n||r||"dateranges"!=e.name?null:e.value.length;return{$orig:i,g14:n,g15:r,g16:s}})):null,m="express"==t.orderInfo.delivery_type&&[3,5].includes(t.status.class_status)&&[2,3,4].includes(t.status.type)&&!t.split.length,I=3==t.status.class_status&&!t.split.length,y=4==t.status.type&&!t.split.length||-2==t.status.type||t.orderInfo.is_del,w=5==t.status.class_status||t.orderInfo.is_del?null:t.orderInfo.is_apply_refund&&0==t.orderInfo.refund_status&&t.cartInfo.length>1&&t.orderInfo.paid,b=5!=t.status.class_status&&!t.orderInfo.is_del&&w?t.cartInfo.length:null;t._isMounted||(t.e0=function(e){t.showQrcode=!0},t.e1=function(e){t.showGiftDrawer=!0},t.e2=function(){t.showQrcode=!1},t.e3=function(e){t.moreBtn=!1}),t.$mp.data=Object.assign({},{$root:{g0:o,g1:i,g2:n,l0:r,g3:s,g4:a,g5:d,g6:c,g7:u,g8:l,g9:f,g10:h,l1:p,g12:_,g13:g,l2:v,g17:m,g18:I,g19:y,g20:w,g21:b}})},n=[]},"4c01":function(t,e,o){"use strict";(function(t,i){var n=o("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(o("7ca3")),s=o("606e"),a=o("7391"),d=o("92f9"),c=o("b0fe"),u=o("5088"),l=o("8f59"),f=n(o("89cc")),h=o("4d38");function p(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,i)}return o}var _=t.getWindowInfo().statusBarHeight,g={components:{invoicePicker:function(){o.e("pages/goods/components/invoicePicker/index").then(function(){return resolve(o("7437"))}.bind(null,o)).catch(o.oe)},verifyModal:function(){o.e("pages/goods/components/verifyModal/index").then(function(){return resolve(o("8841"))}.bind(null,o)).catch(o.oe)},giftDrawer:function(){o.e("pages/goods/components/giftDrawer/index").then(function(){return resolve(o("1f1c"))}.bind(null,o)).catch(o.oe)},tuiModal:function(){o.e("components/tui-modal/index").then(function(){return resolve(o("6b9f"))}.bind(null,o)).catch(o.oe)},NavBar:function(){o.e("components/NavBar").then(function(){return resolve(o("a7d8"))}.bind(null,o)).catch(o.oe)}},mixins:[f.default],data:function(){return{imgHost:h.HTTP_REQUEST_URL,sysHeight:_,giveData:{give_integral:0,give_coupon:[]},giveCartInfo:[],config:{qrc:{code:"",size:360,level:4,bgColor:"#FFFFFF",color:["#333","#333"]}},order_id:"",evaluate:0,cartInfo:[],pid:0,split:[],orderInfo:{system_store:{},_status:{}},system_store:{},isGoodsReturn:!1,status:{},refund_close:!1,isClose:!1,pay_close:!1,pay_order_id:"",totalPrice:"0",isAuto:!1,isShowAuth:!1,routineContact:0,express_num:"",invoice_func:!1,invoiceData:{},invoice_id:0,invChecked:"",moreBtn:!1,invShow:!1,confirmModal:!1,special_invoice:!1,invList:[],userInfo:{},isReturen:"",showQrcode:!1,showGiftDrawer:!1,showModal:!1,modalTitle:"",modalContent:"",confirmText:"",modalType:0,orderId:"",qrc:"",isScrolling:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?p(Object(o),!0).forEach((function(e){(0,r.default)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({giftCount:function(){var t=0;return this.giveCartInfo.length&&(t=this.giveCartInfo.length),this.giveData.give_coupon.length&&(t+=this.giveData.give_coupon.length),this.giveData.give_integral>0&&(t+=1),t}},(0,l.mapGetters)(["isLogin"])),onLoad:function(t){t.order_id&&(this.$set(this,"order_id",t.order_id),this.isReturen=t.isReturen),t.invoice_id&&(this.invoice_id=t.invoice_id),this.activityCodeApi()},onShow:function(){t.removeStorageSync("form_type_cart"),this.isLogin?(this.getOrderInfo(),this.getUserInfo()):(0,u.toLogin)()},onPageScroll:function(e){t.$emit("scroll"),e.scrollTop>50?this.isScrolling=!0:e.scrollTop<50&&(this.isScrolling=!1)},methods:{onLoadFun:function(){this.getOrderInfo(),this.getUserInfo(),this.isShowAuth=!1},authColse:function(t){this.isShowAuth=t},getpreviewImage:function(e,o){t.previewImage({urls:o?this.orderInfo.refund_img:this.orderInfo.refund_goods_img,current:o?this.orderInfo.refund_img[e]:this.orderInfo.refund_goods_img[e]})},showModalChange:function(t){this.modalType=t,1==t?(this.modalTitle="确认收货",this.modalContent="为保障权益，请收到货确认无误后，再确认收货",this.confirmText="确定"):2==t?(this.modalTitle="删除订单",this.modalContent="确定删除该订单?",this.confirmText="确定"):3==t?(this.modalTitle="温馨提示",this.modalContent="确认取消该订单?",this.confirmText="确定"):4==t&&(this.modalTitle="去处理",this.modalContent="该订单有售后处理中，确认收货需先撤销售后申请",this.confirmText="去撤销"),this.showModal=!0},handleTap:function(e){var o=this,i=e.index;1==i?1==this.modalType?(0,s.orderTake)(this.order_id).then((function(t){return o.showModal=!1,o.getOrderInfo(),o.$util.Tips({title:"操作成功",icon:"success"})})).catch((function(t){return o.$util.Tips({title:t})})):2==this.modalType?(0,s.orderDel)(this.order_id).then((function(t){return o.showModal=!1,o.$util.Tips({title:"删除成功",icon:"success"},{tab:3,url:"/pages/goods/order_list/index"})})):3==this.modalType?(this.showModal=!1,(0,s.orderCancel)(this.order_id).then((function(){t.reLaunch({url:"/pages/goods/order_list/index"})}))):4==this.modalType&&(this.showModal=!1,t.navigateTo({url:"/pages/goods/order_after_details/index?isRefund=1&order_id=".concat(this.orderInfo.refund[0].order_id)})):this.showModal=!1},hideModal:function(){this.showModal=!1,this.confirmText=""},goGoodCall:function(){var t="/pages/extension/customer_list/chat?orderId=".concat(this.order_id,"&isReturen=").concat(this.isReturen),e={store_name:this.orderInfo.order_id,path:"/pages/goods/order_details/index?order_id=".concat(this.orderInfo.order_id),image:""};this.$util.getCustomer(this.userInfo,t,e,1)},openAfter:function(e){var o=e;t.showLoading({title:"正在加载"}),(0,a.openOrderRefundSubscribe)().then((function(e){t.hideLoading(),t.navigateTo({url:o})})).catch((function(){t.hideLoading()}))},makePhone:function(e){t.makePhoneCall({phoneNumber:e})},showCodeChange:function(){return this.orderInfo.paid?this.orderInfo.pink_id&&5!=this.orderInfo._status._type?this.$util.Tips({title:"拼团尚未完成"}):void(this.showQrcode=!0):this.$util.Tips({title:"请支付后查看自提码"})},showMaoLocation:function(){if(!this.system_store.latitude||!this.system_store.longitude)return this.$util.Tips({title:"缺少经纬度信息无法查看地图！"});t.openLocation({latitude:parseFloat(this.system_store.latitude),longitude:parseFloat(this.system_store.longitude),scale:8,name:this.system_store.name,address:this.system_store.address+this.system_store.detailed_address,success:function(){}})},getUserInfo:function(){var t=this;(0,d.getUserInfo)().then((function(e){t.userInfo=e.data}))},getOrderInfo:function(){var e=this,o=this;t.showLoading({title:"正在加载中"}),(0,s.getOrderDetail)(this.order_id).then((function(i){var n=i.data._status._type;t.hideLoading(),o.giveData.give_coupon=i.data.give_coupon,o.giveData.give_integral=i.data.give_integral,o.$set(o,"orderInfo",i.data),o.$set(o,"pid",i.data.pid),o.$set(o,"split",i.data.split?i.data.split:[]),o.$set(o,"evaluate",3==n?3:0),o.$set(o,"system_store",i.data.system_store),o.$set(o,"invoiceData",i.data.invoice),o.invoiceData&&(o.invoiceData.pay_price=i.data.pay_price),o.$set(o,"invoice_func",i.data.invoice_func),o.$set(o,"special_invoice",i.data.special_invoice),o.$set(o,"routineContact",Number(i.data.routine_contact_type));var r=i.data.cartInfo,s=[],a=[];r.forEach((function(t){1==t.is_gift?a.push(t):s.push(t)})),o.$set(o,"cartInfo",s),o.$set(o,"giveCartInfo",a),e.$nextTick((function(){o.config.qrc.code=o.orderInfo.verify_code})),0!=e.orderInfo.refund_status?e.isGoodsReturn=!0:e.isReturen=0,o.invoice_id&&!o.invoiceData&&(o.invChecked=o.invoice_id||"",e.invoiceApply()),o.getOrderStatus()})).catch((function(e){t.hideLoading(),t.showToast({title:e,icon:"none"}),t.redirectTo({url:"/pages/goods/order_list/index"})}))},invCancel:function(){this.invChecked="",this.invTitle="不开发票",this.invShow=!1},invSub:function(e){var o=this;this.invChecked=e;var i={order_id:this.order_id,invoice_id:this.invChecked};(0,d.makeUpinvoice)(i).then((function(e){t.showToast({title:"申请成功",icon:"success"}),o.invShow=!1,o.getOrderInfo()})).catch((function(e){t.showToast({title:e,icon:"none"})}))},invClose:function(){this.invShow=!1,this.getInvoiceList()},invoiceApply:function(){this.getInvoiceList(),this.moreBtn=!1,this.invShow=!0},getInvoiceList:function(){var e=this;t.showLoading({title:"正在加载…"}),(0,d.invoiceList)().then((function(o){t.hideLoading(),e.invList=o.data.map((function(t){return t.id=t.id.toString(),t}));var i=e.invList.find((function(t){return t.id==e.invChecked}));if(i){var n="";n+=1===i.header_type?"个人":"企业",n+=1===i.type?"普通":"专用",n+="发票",e.invTitle=n}})).catch((function(e){t.showToast({title:e,icon:"none"})}))},more:function(){this.moreBtn=!this.moreBtn},copy:function(e){t.setClipboardData({data:e})},copyCard:function(){var e=[];this.orderInfo.virtual_info.forEach((function(t,o){e.push("卡号".concat(o+1,": ").concat(t.card_no,"  密码").concat(o+1,":").concat(t.card_pwd))})),t.setClipboardData({data:e.toString()})},getOrderStatus:function(){var t=this.orderInfo||{},e=t._status||{_type:0},o={},i=parseInt(e._type),n=t.delivery_type,r=t.seckill_id?parseInt(t.seckill_id):0,s=t.bargain_id?parseInt(t.bargain_id):0,a=t.discount_id?parseInt(t.discount_id):0,d=t.combination_id?parseInt(t.combination_id):0;o={type:9==i?-9:i,class_status:0,class_again:0},1==i&&d>0&&(o.class_status=1),2==i&&"express"==n&&(o.class_status=2),2==i&&(o.class_status=3),4!=i&&0!=i||(o.class_status=4),r||s||d||a||t.type||3!=i&&4!=i||(o.class_status=5),r||s||d||a||t.type||1!=i&&2!=i&&5!=i||(o.class_again=6),this.$set(this,"status",o)},goJoinPink:function(){t.navigateTo({url:"/pages/activity/goods_combination_status/index?id="+this.orderInfo.pink_id})},goOrderConfirm:function(){var e=this;(0,s.orderAgain)(e.orderInfo.order_id).then((function(e){return t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+e.data.cateId})})).catch((function(t){return e.$util.Tips({title:t})}))},confirmOrder:function(e){if(this.orderInfo.refund.length)this.showModalChange(4);else{var o=this;i.openBusinessView&&this.orderInfo.order_shipping_open&&this.orderInfo.trade_no?(t.showLoading({title:"加载中"}),i.openBusinessView({businessType:"weappOrderConfirm",extraData:{transaction_id:this.orderInfo.trade_no},success:function(){},fail:function(e){return t.hideLoading(),o.$util.Tips({title:e.errMsg})},complete:function(){t.hideLoading()}})):o.showModalChange(1)}},pay_open:function(){t.redirectTo({url:"/pages/goods/cashier/index?order_id=".concat(this.order_id,"&from_type=order")})},goPage:function(e,o){1==e?t.navigateTo({url:o}):2==e?t.switchTab({url:o}):3==e&&t.navigateBack()},openSubcribe:function(e,o){var i=[{cart_id:e.id,cart_num:parseInt(e.cart_num)-parseInt(e.refund_num)}];i=JSON.stringify(i);var n="/pages/goods/goods_return/index?orderId="+this.order_id+"&id="+this.orderInfo.id+"&cartIds="+i+"&productType="+o;t.showLoading({title:"正在加载"}),(0,a.openOrderRefundSubscribe)().then((function(e){t.hideLoading(),t.navigateTo({url:n})})).catch((function(){t.hideLoading()}))},evaluateTap:function(e,o){t.navigateTo({url:"/pages/goods/goods_comment_con/index?unique="+e+"&uni="+o})},closeDrawer:function(){this.showGiftDrawer=!1},activityCodeApi:function(){var t=this;(0,c.activityCodeApi)(91,0,{order_id:this.order_id}).then((function(e){var o=e.data,i=o.routineUrl;o.wechatUrl;t.qrc=i}))}}};e.default=g}).call(this,o("df3c")["default"],o("3223")["default"])},"64d8":function(t,e,o){"use strict";o.r(e);var i=o("37f6"),n=o("bd6a");for(var r in n)["default"].indexOf(r)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(r);o("d20b");var s=o("828b"),a=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"651553fd",null,!1,i["a"],void 0);e["default"]=a.exports},bd6a:function(t,e,o){"use strict";o.r(e);var i=o("4c01"),n=o.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(r);e["default"]=n.a},d20b:function(t,e,o){"use strict";var i=o("da07"),n=o.n(i);n.a},da07:function(t,e,o){}},[["0c2b","common/runtime","common/vendor"]]]);