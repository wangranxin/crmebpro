require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goodsShare/index"],{"0473":function(t,e,o){"use strict";var n=o("505a"),i=o.n(n);i.a},"2a1e":function(t,e,o){"use strict";(function(t){var n=o("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(o("7eb4")),s=n(o("ee10")),r=n(o("7ca3")),a=n(o("89cc")),c=o("4d38"),u=o("0f73"),d=o("92f9"),f=(o("5088"),o("8f59"));function l(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function p(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?l(Object(o),!0).forEach((function(e){(0,r.default)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var h={data:function(){return{imgHost:c.HTTP_REQUEST_URL,id:0,canvasStatus:!1,codeShow:!1,codeVal:"",shareQrcode:0,PromotionCode:"",followCode:"",siteName:"",posterTitle:"",themeColor:"#e93323",fontColor:"#e93323",posterImage:"",storeImage:"",isDown:!0,posterImageStatus:!1,storeInfo:{slider_image:[]},productSwiper:[],showCardOne:!0,shortLink:"",isGrid:!0,mpData:{}}},components:{zbCode:function(){Promise.all([o.e("common/vendor"),o.e("components/zb-code/zb-code")]).then(function(){return resolve(o("4d7f"))}.bind(null,o)).catch(o.oe)}},computed:p(p({},(0,f.mapGetters)(["isLogin","uid"])),{},{shareCardBg:function(){return{backgroundImage:"url("+this.imgHost+"/statics/images/promoter/promoter_group9.png)"}}}),mixins:[a.default],onLoad:function(e){if(!e.id)return this.$util.Tips({title:"缺少参数无法查看商品"},{tab:3});this.id=e.id||0,this.getInfo();var o=t.getStorageSync("MPSiteData");this.mpData=JSON.parse(o),this.getShortLink()},onReady:function(){this.isNodes++;this.isLogin&&this.$store.state.app.uid},methods:{getInfo:function(){var t=this;return(0,s.default)(i.default.mark((function e(){var o,n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,u.getProductDetail)(t.id,{promotions_type:0});case 2:o=e.sent,n=o.data.storeInfo,t.$set(t,"storeInfo",n),t.$set(t,"shareQrcode",o.data.share_qrcode),t.$set(t,"siteName",o.data.site_name),t.$set(t,"posterTitle",o.data.product_poster_title),t.productSwiper=n.slider_image.map((function(t){return{pic:t,select:!1,isQrcode:!1}})),t.goPoster();case 10:case"end":return e.stop()}}),e)})))()},getShortLink:function(){var t=this;(0,u.getShortLinkApi)(this.id).then((function(e){t.shortLink=e.data.code})).catch((function(e){return t.$util.Tips({title:e})}))},copyShare:function(e){var o,n=this.storeInfo.share_content||this.storeInfo.store_name;o=1==e?n+" "+this.shortLink:this.shortLink,t.setClipboardData({data:o,success:function(){t.showToast({title:"复制成功，快去分享吧",icon:"none"})}})},qrR:function(t){},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFileImage:function(e){return e=this.setDomain(e),new Promise((function(o,n){t.downloadFile({url:e,success:function(t){o(t.tempFilePath)},fail:function(t){}})}))},goPoster:function(){var t=this;return(0,s.default)(i.default.mark((function e(){var o,n,s,r,a,c;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=t,e.next=3,t.downloadFileImage(t.storeInfo.image);case 3:return n=e.sent,e.next=6,t.downloadFileImage(t.imgHost+"/statics/images/product/posterbackgd.png");case 6:return s=e.sent,e.next=9,(0,u.getProductCode)(o.id);case 9:if(r=e.sent,r.data.code){e.next=12;break}return e.abrupt("return",o.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"}));case 12:return e.next=14,t.downloadFileImage(r.data.code);case 14:a=e.sent,o.$set(o,"canvasStatus",!0),c=[s,n,a],o.$nextTick((function(){setTimeout((function(){o.$util.PosterCanvas(o.fontColor,o.themeColor,o.siteName,c,o.storeInfo.store_name,o.storeInfo.price,o.storeInfo.ot_price,o.posterTitle,(function(t){o.$set(o,"posterImage",t),o.$set(o,"posterImageStatus",!0),o.$set(o,"canvasStatus",!1),o.productSwiper.unshift({pic:t,select:!1,isQrcode:!0})}))}),1e3)}));case 18:case"end":return e.stop()}}),e)})))()},cardShare:function(){},appShare:function(){t.share({provider:"weixin",scene:"WXSceneSession",type:0,href:"".concat(c.HTTP_REQUEST_URL,"/pages/goods_details/index?id=").concat(this.id,"&spid=").concat(this.uid),title:this.storeInfo.store_name,summary:this.storeInfo.store_info,imageUrl:this.storeInfo.small_image,success:function(t){},fail:function(e){t.showToast({title:"分享失败",icon:"none",duration:2e3})}})},selectPic:function(t){t.select=!t.select},savePhoto:function(e){var o=this;t.getSetting({success:function(n){n.authSetting["scope.writePhotosAlbum"]?"poster"==e?o.savePoster():o.mpSave():t.authorize({scope:"scope.writePhotosAlbum",success:function(){"poster"==e?o.savePoster():o.mpSave()}})}})},mpSave:function(){var e=this,o=this.productSwiper.filter((function(t){return t.select})),n=o.length,i=0;t.showLoading({title:"图片下载中",mask:!0});for(var s=0;s<o.length;s++)o[s].isQrcode?this.savePoster():t.downloadFile({url:o[s].pic,success:function(o){var s=o.tempFilePath;t.saveImageToPhotosAlbum({filePath:s,success:function(o){i++,i==n&&(t.hideLoading(),e.$util.Tips({title:"保存成功",icon:"success"}))},fail:function(o){t.hideLoading(),e.$util.Tips({title:"保存失败"})}})},fail:function(e){t.hideLoading()}})},savePoster:function(){var e=this;t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})},proviewPhoto:function(e){var o=this.productSwiper.map((function(t){return t.pic}));t.previewImage({current:e,urls:o})}},onShareAppMessage:function(){return(0,d.userShare)(),{title:this.storeInfo.store_name||"",imageUrl:this.storeInfo.image||"",path:"/pages/goods_details/index?id="+this.id+"&spid="+this.uid}},onShareTimeline:function(){return(0,d.userShare)(),{title:this.storeInfo.store_name||"",imageUrl:this.storeInfo.image||"",path:"/pages/goods_details/index?id="+this.id+"&spid="+this.uid}}};e.default=h}).call(this,o("df3c")["default"])},5049:function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__get_style([t.shareCardBg])),n=t.storeInfo.slider_image.length,i=t.storeInfo.slider_image.length;t._isMounted||(t.e0=function(){t.isGrid=!t.isGrid}),t.$mp.data=Object.assign({},{$root:{s0:o,g0:n,g1:i}})},i=[]},"505a":function(t,e,o){},"540f":function(t,e,o){"use strict";o.r(e);var n=o("5049"),i=o("8b41");for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("0473");var r=o("828b"),a=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=a.exports},"6c2f":function(t,e,o){"use strict";(function(t,e){var n=o("47a9");o("f076");n(o("3240"));var i=n(o("540f"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(i.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"8b41":function(t,e,o){"use strict";o.r(e);var n=o("2a1e"),i=o.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a}},[["6c2f","common/runtime","common/vendor"]]]);