(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/discover/discoverCreate/index"],{"2efc":function(t,i,e){"use strict";(function(t){var o=e("47a9");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=o(e("7ca3")),a=o(e("89cc")),c=o(e("d1e1")),r=e("8f59"),u=e("5088"),s=e("4d38"),d=(e("0f73"),e("eb8a"));e("2c18");function l(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);i&&(o=o.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,o)}return e}function p(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?l(Object(e),!0).forEach((function(i){(0,n.default)(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var f=getApp(),h={data:function(){return{sysHeight:f.globalData.sysHeight,id:"",canvasStatus:!1,visible:!1,tabActive:0,keyword:"",topicList:[],recommendTopic:[],topicSelectedList:[],productList:[],productSelect:[],loading:!1,where:{page:1,limit:20,type:"pay",keyword:""},formData:{content_type:null,title:"",content:"",image:"",video_url:"",slider_image:[],topic_name:[],product_id:[]},upload_max:50,uploadUrl:"".concat(s.HTTP_REQUEST_URL,"/api/upload/video"),videoContext:"",productNum:0,topicNum:0,canvasWidth:"",canvasHeight:"",configData:{community_exp_num:0,community_integral_num:0}}},components:{baseDrawer:function(){e.e("components/tui-drawer/tui-drawer").then(function(){return resolve(e("af01"))}.bind(null,e)).catch(e.oe)},emptyPage:function(){e.e("components/emptyPage").then(function(){return resolve(e("398a"))}.bind(null,e)).catch(e.oe)}},computed:p(p({},(0,r.mapGetters)(["isLogin"])),{},{videoHtml:function(){return'<video  autoplay loop muted controls="controls" width="100%" height="870px"><source src="'.concat(this.formData.video_url,'" type="video/mp4"></video>')},videoStyle:function(){return{width:t.getWindowInfo().windowWidth+"px",height:t.getWindowInfo().windowHeight+"px"}},popupHeight:function(){return.8*t.getWindowInfo().windowHeight}}),mixins:[a.default],onShow:function(){var i=this;t.$on("topicSave",(function(e){e&&(i.topicSelectedList=e),t.$off("topicSave")}))},onLoad:function(i){this.isLogin?(this.getConfig(),i.id&&(this.id=i.id,this.getInfo()),i.topic_name&&this.topicSelectedList.push({name:i.topic_name}),this.getProductList(),this.videoContext=t.createVideoContext("myVideo",this)):(0,u.toLogin)()},methods:{getConfig:function(){var t=this;(0,d.getCommunityConfig)().then((function(i){t.configData=i.data}))},proviewPic:function(i){t.previewImage({urls:this.formData.slider_image,current:i})},DelPic:function(t){this.formData.slider_image.splice(t,1)},delVideo:function(){this.formData.video_url=""},openVideoPopup:function(){var i=this;this.$refs.popup.open(),this.videoContext=t.createVideoContext("myVideo",this),this.$nextTick((function(){i.videoContext.play()}))},hideModal:function(){this.$refs.popup.close()},uploadPoster:function(){var t=this,i=this;this.canvasStatus=!0,i.$util.uploadImageChange({count:1,url:"upload/image"},(function(t){i.formData.image=t.data.url}),(function(i){t.canvasStatus=!1}),(function(i){t.canvasWidth=i.w,t.canvasHeight=i.h}))},uploadpic:function(){var t=this,i=this;this.canvasStatus=!0,i.$util.uploadImageChange({count:9,url:"upload/image"},(function(t){if(9==i.formData.slider_image.length)return i.$util.Tips({title:"最多上传9张"});i.formData.slider_image.push(t.data.url)}),(function(i){t.canvasStatus=!1}),(function(i){t.canvasWidth=i.w,t.canvasHeight=i.h}))},uploadVideo:function(){var i=this,e=this;t.chooseVideo({sourceType:["camera","album"],success:function(o){t.showLoading({title:"视频上传中"}),Math.ceil(o.size/1024)<1024*e.upload_max?t.uploadFile({url:e.uploadUrl,filePath:o.tempFilePath,name:"file",header:(0,n.default)({"Content-Type":"multipart/form-data"},s.TOKENNAME,"Bearer "+c.default.state.app.token),success:function(o){t.hideLoading();var n=JSON.parse(o.data);if(200!=n.status)return i.$util.Tips({title:n.msg});e.formData.video_url=n.data.url},complete:function(i){t.hideLoading()}}):(t.hideLoading(),t.showModal({title:"提示",showCancel:!1,content:"视频超出限制".concat(e.upload_max,"MB")}))},fail:function(t){e.$util.Tips({title:t})}})},confirmProductDrawer:function(){this.visible=!1},openDrawer:function(i){var e=this;if(1==i)this.id&&this.productList.map((function(t){e.formData.product_id.forEach((function(i){i===t.product_id&&e.$set(t,"isSelect",!0)}))})),this.visible=!this.visible;else{var o="";this.topicSelectedList.length&&(o=JSON.stringify(this.topicSelectedList)),t.navigateTo({url:"/pages/discover/discoverCreate/topic?data="+o})}},getProductList:function(){var t=this;this.loading||(this.loading=!0,(0,d.getProductApi)(this.where).then((function(i){i.data.map((function(i){t.$set(i,"isSelect",!1),t.formData.product_id.forEach((function(e){e===i.product_id&&t.$set(i,"isSelect",!0)}))}));var e=i.data,o=e.length<t.where.limit;t.productList=t.productList.concat(e),t.where.page++,t.loading=o})).catch((function(i){return t.loading=!1,t.$util.Tips({title:i})})))},getSearch:function(){this.loading=!1,this.where.page=1,this.productList=[],this.getProductList()},changeTab:function(t,i){this.tabActive=t,this.where.type=i,this.getSearch()},selectItem:function(t){if(t.isSelect){if(t.isSelect=!1,this.formData.product_id.includes(t.product_id)){var i=this.productSelect.findIndex((function(i){return i.id==t.product_id}));this.productSelect.splice(i,1),this.formData.product_id.splice(i,1),this.productNum--}}else{if(5==this.productSelect.length)return this.$util.Tips({title:"最多选择5件商品"});t.isSelect=!0;var e=[];this.productSelect.forEach((function(t){e.push(t.id)})),e.includes(t.product_id)||(this.productNum++,this.productSelect.push(t),this.formData.product_id.push(t.product_id))}},confirmSave:function(){var i=this;if(!this.formData.content)return this.$util.Tips({title:"请输入内容"});if(!this.formData.video_url&&!this.formData.slider_image.length)return this.$util.Tips({title:"请上传要分享的图片"});if(this.formData.video_url&&!this.formData.image)return this.$util.Tips({title:"请上传海报"});this.formData.topic_name=this.topicSelectedList.map((function(t){return t.name})),this.formData.content_type=this.formData.slider_image.length?1:2,t.showLoading({title:"正在提交..."});var e="";e=this.id?(0,d.communityUpdateApi)(this.id,this.formData):(0,d.communitySaveApi)(this.formData),e.then((function(e){t.hideLoading();i.configData.community_exp_num,i.configData.community_integral_num;return i.$util.Tips({title:e.msg},{tab:4,url:"/pages/discoverIndex/index"})})).catch((function(e){return t.hideLoading(),i.$util.Tips({title:e})}))},getInfo:function(){var t=this;(0,d.communityInfoApi)(this.id).then((function(i){var e=i.data,o=Object.keys(t.formData);o.map((function(i){t.formData[i]=e[i]})),null==t.formData.product_id&&(t.formData.product_id=[]),i.data.topic.length&&(t.topicSelectedList=i.data.topic),i.data.product&&i.data.product.length&&(t.productSelect=i.data.product),t.productNum=i.data.product.length,t.topicNum=i.data.topic.length})).catch((function(i){return t.$util.Tips({title:i})}))}}};i.default=h}).call(this,e("df3c")["default"])},3469:function(t,i,e){},4872:function(t,i,e){"use strict";(function(t,i){var o=e("47a9");e("f076");o(e("3240"));var n=o(e("672b"));t.__webpack_require_UNI_MP_PLUGIN__=e,i(n.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},"4f10":function(t,i,e){},"672b":function(t,i,e){"use strict";e.r(i);var o=e("ba95"),n=e("ec7c");for(var a in n)["default"].indexOf(a)<0&&function(t){e.d(i,t,(function(){return n[t]}))}(a);e("81bf"),e("8f47");var c=e("828b"),r=Object(c["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);i["default"]=r.exports},"81bf":function(t,i,e){"use strict";var o=e("3469"),n=e.n(o);n.a},"8f47":function(t,i,e){"use strict";var o=e("4f10"),n=e.n(o);n.a},ba95:function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"c",(function(){return a})),e.d(i,"a",(function(){return o}));var o={uniPopup:function(){return e.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(e.bind(null,"b29f"))}},n=function(){var t=this,i=t.$createElement,e=(t._self._c,!t.formData.video_url&&t.formData.slider_image.length<9),o=!t.formData.slider_image.length&&!t.formData.video_url,n=t.topicSelectedList.length,a=t.topicSelectedList.length,c=t.productSelect.length,r=t.productSelect.length,u=t.productList.length,s=t.__get_style([t.videoStyle]);t.$mp.data=Object.assign({},{$root:{g0:e,g1:o,g2:n,g3:a,g4:c,g5:r,g6:u,s0:s}})},a=[]},ec7c:function(t,i,e){"use strict";e.r(i);var o=e("2efc"),n=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){e.d(i,t,(function(){return o[t]}))}(a);i["default"]=n.a}},[["4872","common/runtime","common/vendor"]]]);