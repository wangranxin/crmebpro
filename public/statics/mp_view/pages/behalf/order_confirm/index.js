require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/behalf/order_confirm/index"],{"08ec":function(t,e,i){"use strict";var s=i("0aab"),n=i.n(s);n.a},"0aab":function(t,e,i){},"19b0":function(t,e,i){"use strict";(function(t,e){var s=i("47a9");i("f076");s(i("3240"));var n=s(i("cfed2"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"37bc":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var s=function(){var t=this,e=t.$createElement,i=(t._self._c,0==t.shippingType?[1,2].includes(t.isDisplay):null),s=0!=t.shippingType?[1,2].includes(t.isDisplay):null,n=0!=t.shippingType?t.storeList.length:null,o=0!=t.shippingType&&n>0?(t.range/1e3).toFixed(1):null,r=[0,6].includes(t.goodsType)&&0==t.news,a=t.giftCount>0?t.giveData.give_coupon.length:null,u=[0,6].includes(t.type)&&1==t.integral_ratio_status,d=t.priceGroup.storePostage>0?(parseFloat(t.priceGroup.storePostage)+parseFloat(t.priceGroup.storePostageDiscount)).toFixed(2):null,c=t.priceGroup.vipPrice>0&&t.userInfo.vip&&[0,6].includes(t.type),p=c?parseFloat(t.priceGroup.vipPrice).toFixed(2):null,l=t.priceGroup.storePostageDiscount>0?parseFloat(t.priceGroup.storePostageDiscount).toFixed(2):null,h=t.coupon_price>0?parseFloat(t.coupon_price).toFixed(2):null,f=t.integral_price>0?parseFloat(t.integral_price).toFixed(2):null,g=t.__map(t.promotions_detail,(function(e,i){var s=t.__get_orig(e),n=parseFloat(e.promotions_price),o=parseFloat(e.promotions_price).toFixed(2);return{$orig:s,m0:n,g13:o}})),I=t.addressList.length;t._isMounted||(t.e0=function(e){t.showGiftDrawer=!0},t.e1=function(){t.showAddressDrawer=!1},t.e2=function(){t.showPayDrawer=!1},t.e3=function(e){t.showPayDrawer=!1}),t.$mp.data=Object.assign({},{$root:{g0:i,g1:s,g2:n,g3:o,g4:r,g5:a,g6:u,g7:d,g8:c,g9:p,g10:l,g11:h,g12:f,l0:g,g14:I}})},n=[]},c551:function(t,e,i){"use strict";(function(t){var s=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i("7ca3")),o=(s(i("f89f")),i("6af6")),r=i("7391"),a=i("0f73"),u=(i("769c"),i("5088")),d=i("8f59"),c=s(i("89cc")),p=i("4d38"),l=i("2c18");function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){(0,n.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var g=t.getWindowInfo().statusBarHeight,I={components:{couponListWindow:function(){Promise.all([i.e("common/vendor"),i.e("components/couponListWindow/index")]).then(function(){return resolve(i("a5f2"))}.bind(null,i)).catch(i.oe)},giftDrawer:function(){i.e("pages/behalf/components/giftDrawer").then(function(){return resolve(i("b65d"))}.bind(null,i)).catch(i.oe)},tuiModal:function(){i.e("components/tui-modal/index").then(function(){return resolve(i("6b9f"))}.bind(null,i)).catch(i.oe)},baseDrawer:function(){i.e("components/tui-drawer/tui-drawer").then(function(){return resolve(i("af01"))}.bind(null,i)).catch(i.oe)},emptyPage:function(){i.e("components/emptyPage").then(function(){return resolve(i("398a"))}.bind(null,i)).catch(i.oe)}},mixins:[c.default],data:function(){return{imgHost:p.HTTP_REQUEST_URL,sysHeight:g,addressInfoArea:[],cityShow:2,display:!1,timeranges:[],isShow:!1,giveData:{give_integral:0,give_coupon:[]},giveCartInfo:[],confirm:[],id:0,isAddress:!1,textareaStatus:!0,formContent:"",payType:"weixin",openType:1,active:0,coupon:{coupon:!1,list:[],statusTile:"立即使用"},showAddressDrawer:!1,addressInfo:{},pinkId:0,addressId:0,couponId:0,cartId:"",type:0,activityId:0,BargainId:0,combinationId:0,seckillId:0,discountId:0,userInfo:{},mark:"",couponTitle:"请选择",coupon_price:0,promotions_detail:[],useIntegral:!1,integral_price:0,integral:0,ChangePrice:0,formIds:[],status:0,is_address:!1,shippingType:0,system_store:{},storePostage:0,mydata:{},storeList:[],store_self_mention:0,cartInfo:[],priceGroup:{},animated:!1,totalPrice:0,totalIntegral:0,integralRatio:"0",orderKey:"",offlinePostage:"",isAuto:!1,isShowAuth:!1,from:"",news:1,integral_ratio_status:1,header_type:"",pay_close:!1,noCoupon:0,valid_count:0,discount_id:0,storeId:0,product_type:1,newImg:[],isDisplay:0,goodsType:0,timerangesIndex:0,isFocus:!1,latitude:"",longitude:"",site_logo:"",range:"",showGiftDrawer:!1,svip_status:!1,svip_price:0,contactsFocus:!1,telFocus:!1,userId:0,addressList:[],addressActive:0,userPhone:"",showPayDrawer:!1,isCash:0}},computed:f(f({},(0,d.mapGetters)(["isLogin"])),{},{giftCount:function(){var t=0;return this.giveCartInfo.length&&(t=this.giveCartInfo.length),this.giveData.give_coupon.length&&(t+=this.giveData.give_coupon.length),this.giveData.give_integral>0&&(t+=1),t},canSubmit:function(){return!!(0==this.shippingType&&this.addressInfo.city||1==this.shippingType&&this.userInfo.real_name&&this.userInfo.phone&&0!=this.userId||1==this.shippingType&&0==this.userId)}}),onLoad:function(t){if(this.getLocation(),this.from="routine",!t.cartId)return this.$util.Tips({title:"请选择要购买的商品"},{tab:3,url:1});this.cartId=t.cartId,this.userId=t.uid,this.news=t.news,this.is_address=!!t.is_address,this.textareaStatus=!0,this.isLogin?(this.getAddressInfo(),this.getConfirm()):(0,u.toLogin)()},onShow:function(){var e=this;t.$on("refresh",(function(t){e.addressInfo.province=t.address.province,e.$set(e.addressInfo,"city",t.address.city),e.addressInfo.district=t.address.district,e.addressInfo.street=t.address.street,e.addressInfo.detail=t.detail,e.addressInfo.real_name=t.real_name,e.addressInfo.phone=t.phone,e.addressInfo.id=0,e.showAddressDrawer=!1}))},methods:{goPay:function(t){this.isCash=t,this.formVerify()},getLocation:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.latitude=t.latitude,e.longitude=t.longitude}})},getList:function(){var t=this,e={page:1,limit:10,latitude:this.latitude,longitude:this.longitude};(0,a.storeListApi)(e).then((function(e){var i=e.data.list.list||[];t.$set(t,"storeList",i),t.$set(t,"system_store",i[0]),t.$set(t,"storeId",i[0].id),t.site_logo=e.data.site_logo,t.range=i[0].range,t.getConfirm()})).catch((function(t){}))},computedPrice:function(){var t=this,e=this.shippingType;(0,o.postOrderComputed)(this.orderKey,this.userId,{addressId:this.addressInfo.id,useIntegral:this.useIntegral?1:0,couponId:0==this.priceGroup.couponPrice?0:this.couponId,shipping_type:parseInt(e)+1,payType:this.payType}).then((function(i){var s=i.data.result;s&&(t.totalPrice=s.pay_price,t.totalIntegral=s.pay_integral,t.integral_price=s.deduction_price,t.coupon_price=s.coupon_price,t.promotions_detail=s.promotions_detail,t.integral=t.useIntegral?s.SurplusIntegral:t.userInfo.integral,t.$set(t.priceGroup,"storePostage",1==e?0:s.pay_postage),t.$set(t.priceGroup,"storePostageDiscount",s.storePostageDiscount))})).catch((function(e){return t.$util.Tips({title:e})}))},addressType:function(t){var e=t;this.shippingType=parseInt(e),1==e?this.getList():this.getConfirm()},bindPickerChange:function(t){var e=t.detail.value;this.shippingType=e,this.computedPrice()},ChangCouponsClone:function(){this.$set(this.coupon,"coupon",!1)},ChangCoupons:function(t){var e=this.coupon.list;e[t].is_use?(e[t].use_title="",e[t].is_use=0,this.couponTitle="请选择",this.couponId=0):(e[t].use_title="不使用",e[t].is_use=1,this.couponTitle=e[t].title,this.couponId=e[t].id),this.$set(this.coupon,"coupon",!1),this.$set(this.coupon,"list",e),this.getConfirm(1)},ruleToggle:function(t){this.coupon.list[t].ruleshow=!this.coupon.list[t].ruleshow},ChangeIntegral:function(){this.useIntegral=!this.useIntegral,this.computedPrice()},bindHideKeyboard:function(t){this.mark=t.detail.value},objToArr:function(t){var e=Object.keys(t),i=e.map((function(e){return t[e]}));return i},getConfirm:function(t){var e=this,i=this,s=parseInt(this.shippingType)+1;1==s?i.addressInfo.id:("",i.storeId);var n={cartId:i.cartId,new:i.news,shipping_type:s,addressId:""};(0,o.orderConfirm)(this.userId,n).then((function(t){1==t.data.upgrade_addr&&(i.id=t.data.addressInfo.id,e.isAddress=!0),i.$set(i,"goodsType",t.data.type),i.$set(i,"userInfo",t.data.userInfo),i.$set(i,"userPhone",t.data.userInfo.phone),i.$set(i,"integral",t.data.userInfo.integral),i.$set(i,"integralRatio",t.data.integralRatio),i.$set(i,"offlinePostage",t.data.offlinePostage),i.$set(i,"orderKey",t.data.orderKey),i.$set(i,"valid_count",t.data.valid_count),i.$set(i,"discount_id",t.data.discount_id),i.$set(i,"priceGroup",t.data.priceGroup),i.$set(i,"type",parseInt(t.data.type)),i.$set(i,"activityId",parseInt(t.data.activityId)),i.$set(i,"seckillId",parseInt(t.data.seckill_id)),i.$set(i,"BargainId",parseInt(t.data.bargain_id)),i.$set(i,"combinationId",parseInt(t.data.combination_id)),i.$set(i,"discountId",parseInt(t.data.discount_id)),i.$set(i,"integral_ratio_status",t.data.integral_ratio_status),i.$set(i,"store_self_mention",t.data.store_self_mention),i.$set(i,"svip_status",t.data.svip_status),i.$set(i,"svip_price",t.data.svip_price),i.giveData.give_integral=t.data.give_integral,i.giveData.give_coupon=t.data.give_coupon;var s=t.data.cartInfo,n=[],o=[];s.forEach((function(t){1==t.is_gift?o.push(t):n.push(t)})),i.$set(i,"cartInfo",n),i.$set(i,"giveCartInfo",o);var r=-1;o.forEach((function(t){if(0==t.product_type)return r=0})),i.$set(i,"product_type",0==t.data.product_type||0==r?0:1),i.$set(i,"ChangePrice",i.totalPrice),i.getCouponList(),i.computedPrice(),i.$set(i,"totalPrice",i.$util.$h.Add(parseFloat(t.data.priceGroup.totalPrice),parseFloat(t.data.priceGroup.storePostage)))})).catch((function(t){return e.$util.Tips({title:t})}))},getCouponList:function(){var t=this,e=this,i={cartId:this.cartId,new:this.news,shipping_type:e.$util.$h.Add(e.shippingType,1),store_id:e.system_store?e.system_store.id:0};(0,o.getCouponsOrderPrice)(this.userId,i).then((function(i){i.data.map((function(e){t.$set(e,"ruleshow",!1)})),e.$set(e.coupon,"list",i.data),e.openType=1})).catch((function(t){return e.$util.Tips({title:t})}))},getAddressInfo:function(){var e=this;(0,o.adminUserAddressList)(this.userId,{page:1,limit:10}).then((function(t){e.addressList=t.data,t.data.length&&(e.addressInfo=t.data[0])})).catch((function(i){return t.hideLoading(),e.$util.Tips({title:i})}))},showMaoLocation:function(){t.openLocation({latitude:parseFloat(this.system_store.longitude),longitude:parseFloat(this.system_store.latitude),scale:8,name:this.system_store.name,address:this.system_store.address+this.system_store.detailed_address})},couponTap:function(){var t=this;this.coupon.coupon=!0,this.coupon.list.forEach((function(e,i){e.id==t.couponId?e.is_use=1:e.is_use=0})),this.$set(this.coupon,"list",this.coupon.list)},car:function(){this.animated=!1},onAddress:function(){this.showAddressDrawer=!0},goAddressPages:function(){t.navigateTo({url:"/pages/users/user_address/addClient"})},tapAddress:function(t,e){this.addressActive=t,this.addressInfo=e},payment:function(e){var i=this,s=this;(0,o.orderCreate)(s.orderKey,s.userId,e).then((function(e){if(i.$Cache.clear("touristId"),t.hideLoading(),i.isCash){var s={uni:e.data.result.order_id,paytype:"cash",quitUrl:""};(0,o.getCashierApi)(i.userId,s).then((function(t){if("SUCCESS"==t.data.status)return i.$util.Tips({title:"支付成功"},{tab:5,url:"/pages/admin/orderDetail/index?id="+e.data.result.order_id})})).catch((function(t){return i.$util.Tips({title:t})}))}else t.redirectTo({url:"/pages/behalf/cashier/index?order_id=".concat(e.data.result.order_id,"&uid=").concat(i.userId)})})).catch((function(e){return t.hideLoading(),s.$util.Tips({title:e})}))},clickTextArea:function(){this.$refs.textarea.focus()},bindDateChange:function(t,e){this.confirm[e].value=t.target.value},bindTimeChange:function(t,e){this.confirm[e].value=t.target.value},bindSelectChange:function(t,e,i){this.confirm[e].value=i.wordsConfig.list[t.detail.value].val},getTimeranges:function(t){this.isShow=!0,this.timerangesIndex=t},confrim:function(t){this.isShow=!1,this.confirm[this.timerangesIndex].value=t.time;var e=[];t.val.forEach((function(t){e.push(Number(t))})),this.timeranges=e},formVerify:function(){if(!this.addressInfo.real_name&&!this.shippingType&&!this.product_type)return this.$util.Tips({title:"请选择收货地址"});if(1==this.shippingType&&0!=this.userId){if(""==this.userInfo.real_name||""==this.userInfo.phone)return this.$util.Tips({title:"请填写联系人或联系人电话"});if(!/^1(3|4|5|7|8|9|6)\d{9}$/.test(this.userInfo.phone))return this.$util.Tips({title:"请填写正确的手机号"});if(!/^[\u4e00-\u9fa5\w]{2,16}$/.test(this.userInfo.real_name))return this.$util.Tips({title:"请填写您的真实姓名"});if(0==this.storeList.length)return this.$util.Tips({title:"暂无门店,请选择其他方式"})}if(4==this.type&&this.totalIntegral>this.userInfo.integral)return this.$util.Tips({title:"您的积分不足以抵扣本单积分金额"});this.SubOrder()},SubOrder:function(e){var i,s=this;i={real_name:0==s.shippingType?s.addressInfo.real_name:s.userInfo.real_name,phone:0==s.shippingType?s.addressInfo.phone:s.userInfo.phone,address:0==s.shippingType?s.addressInfo.province+s.addressInfo.city+s.addressInfo.district+s.addressInfo.street+s.addressInfo.detail:"",addressId:s.addressInfo.id,couponId:0==s.priceGroup.couponPrice?0:s.couponId,useIntegral:s.useIntegral,mark:s.mark,shipping_type:s.$util.$h.Add(s.shippingType,1)},t.showLoading({title:"订单支付中"}),(0,r.openPaySubscribe)().then((function(){s.payment(i)}))},goDetail:function(e){t.navigateTo({url:"/pages/goods_details/index?id=".concat(e,"&fromType=1")})},addCart:function(t,e){var i=this;if(1==t&&e.productInfo.stock==e.cart_num)return this.$util.Tips({title:"该产品没有更多库存了！"});(0,o.adminCartNum)(this.userId,{id:e.id,number:t?e.cart_num+1:e.cart_num-1,tourist_uid:0==this.userId?this.$Cache.get("touristId"):""}).then((function(t){i.getConfirm(),setTimeout((function(){i.computedPrice()}),500)})).catch((function(t){return i.$util.Tips({title:t})}))},setValue:(0,l.Debounce)((function(t,e){var i=this,s=t.detail.value;if(e.productInfo.limit_num>0&&s>e.productInfo.limit_num)return e.cart_num=e.productInfo.limit_num,this.$util.Tips({title:"购物车数量不能大于限购数量"});(0,o.adminCartNum)(this.userId,{id:e.id,number:s,tourist_uid:0==this.userId?this.$Cache.get("touristId"):""}).then((function(t){i.getConfirm(),setTimeout((function(){i.computedPrice()}),500)})).catch((function(t){return i.$util.Tips({title:t})}))})),goPage:function(e,i){1==e?t.navigateTo({url:i}):2==e?t.switchTab({url:i}):3==e&&t.navigateBack()},closeDrawer:function(){this.showGiftDrawer=!1},hideModal:function(){this.isAddress=!1},handleClick:function(e){var i=e.index;1==i&&t.navigateTo({url:"/pages/users/user_address/index?id="+this.id+"&new="+this.news+"&cartId="+this.cartId+"&pinkId="+this.pinkId+"&couponId="+this.couponId}),this.isAddress=!1},clearInput:function(t){0==t?(this.userInfo.real_name="",this.contactsFocus=!0):(this.userInfo.phone="",this.telFocus=!0)},payDrawerChange:function(){this.showPayDrawer=!0}}};e.default=I}).call(this,i("df3c")["default"])},cd2f:function(t,e,i){"use strict";i.r(e);var s=i("c551"),n=i.n(s);for(var o in s)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(o);e["default"]=n.a},cfed2:function(t,e,i){"use strict";i.r(e);var s=i("37bc"),n=i("cd2f");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("08ec");var r=i("828b"),a=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,"cedf4212",null,!1,s["a"],void 0);e["default"]=a.exports}},[["19b0","common/runtime","common/vendor"]]]);