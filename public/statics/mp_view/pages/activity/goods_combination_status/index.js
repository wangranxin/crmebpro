(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/goods_combination_status/index"],{2379:function(t,e,i){"use strict";var s=i("e02d"),o=i.n(s);o.a},3895:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return s}));var s={easyLoadimage:function(){return i.e("components/easy-loadimage/easy-loadimage").then(i.bind(null,"94dd"))}},o=function(){var t=this,e=t.$createElement,i=(t._self._c,t.titleText()),s=t.pinkAll.length,o=(1===t.pinkBool||-1===t.pinkBool)&&t.pinkAll.length>9;t._isMounted||(t.e0=function(e){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{m0:i,g0:s,g1:o}})},n=[]},"96a5":function(t,e,i){"use strict";(function(t,e){var s=i("47a9");i("f076");s(i("3240"));var o=s(i("9c37"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"9c37":function(t,e,i){"use strict";i.r(e);var s=i("3895"),o=i("ae58");for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);i("2379");var a=i("828b"),r=Object(a["a"])(o["default"],s["b"],s["c"],!1,null,"bfa22782",null,!1,s["a"],void 0);e["default"]=r.exports},ae58:function(t,e,i){"use strict";i.r(e);var s=i("f95d"),o=i.n(s);for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e["default"]=o.a},e02d:function(t,e,i){},f95d:function(t,e,i){"use strict";(function(t){var s=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(i("7eb4")),n=s(i("ee10")),a=s(i("3b2d")),r=s(i("7ca3")),c=s(i("1e56")),u=i("5088"),d=i("8f59"),h=i("b0fe"),l=i("0f73"),p=s(i("89cc")),m=i("4d38"),g=t.getWindowInfo().statusBarHeight,f=getApp(),_={name:"GroupRule",components:{CountDown:function(){i.e("components/countDown/index").then(function(){return resolve(i("1706"))}.bind(null,i)).catch(i.oe)},ProductWindow:function(){i.e("components/productWindow/index").then(function(){return resolve(i("bae9"))}.bind(null,i)).catch(i.oe)},NavBar:function(){i.e("components/NavBar").then(function(){return resolve(i("a7d8"))}.bind(null,i)).catch(i.oe)}},data:function(){var t;return t={sysHeight:g,currentPinkOrder:"",isOk:0,pinkBool:0,userBool:0,pinkAll:[],pinkT:[],storeCombination:[],storeCombinationHost:[],pinkId:0,count:0,iShidden:!1,isOpen:!1,attr:{cartAttr:!1,productSelect:{image:"",store_name:"",price:"",quota:0,unique:"",cart_num:1,quota_show:0,product_stock:0,num:0},productAttr:[]},cart_num:"",userInfo:{},posters:!1,weixinStatus:!1,H5ShareBox:!1,isAuto:!1,isShowAuth:!1,attrTxt:"请选择",attrValue:"",imgHost:m.HTTP_REQUEST_URL,addressId:"",store_id:"",delivery_type:0,store_name:"",endTime:!1,skuArr:[],posterImageStatus:!1,posterImage:"",canvasStatus:!1,codeShow:!1,cid:"1",val:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",icon:"",iconsize:40,onval:!0,loadMake:!0,codeSrc:""},(0,r.default)(t,"endTime",!1),(0,r.default)(t,"pageScrollStatus",!1),t},mixins:[p.default],computed:(0,d.mapGetters)({isLogin:"isLogin",userData:"userInfo"}),watch:{isLogin:{handler:function(t,e){t?this.getCombinationPink():this.getIsLogin()},deep:!0},userData:{handler:function(t,e){t&&(this.userInfo=t,f.globalData.openPages="/pages/activity/goods_combination_status/index?id="+this.pinkId)},deep:!0}},onLoad:function(t){if(t.scene){var e=c.default.getUrlParams(decodeURIComponent(t.scene));"object"===(0,a.default)(e)&&(e.id&&(t.id=e.id),e.spid&&(f.globalData.spid=e.spid))}t.id&&(this.pinkId=t.id),t.spid&&(f.globalData.spid=t.spid),0==this.isLogin?(this.$Cache.set("login_back_url","/pages/activity/goods_combination_status/index?id=".concat(t.id)),this.getIsLogin()):this.getCombinationPink()},onShow:function(){t.removeStorageSync("form_type_cart")},onPageScroll:function(e){e.scrollTop>80?this.pageScrollStatus=!0:e.scrollTop<80&&(this.pageScrollStatus=!1),t.$emit("scroll")},onShareAppMessage:function(){return{title:"您的好友"+this.userInfo.nickname+"邀请您参团"+this.storeCombination.title,path:f.globalData.openPages,imageUrl:this.storeCombination.image}},onShareTimeline:function(){return{title:"您的好友"+this.userInfo.nickname+"邀请您参团"+this.storeCombination.title,path:f.globalData.openPages,imageUrl:this.storeCombination.image}},methods:{titleText:function(){return this.pinkT.uid==this.$store.state.app.uid?"开团":"参团"},onLoadFun:function(){this.getCombinationPink(),this.isShowAuth=!1},getIsLogin:function(){(0,u.toLogin)()},authColse:function(t){this.isShowAuth=t},listenerActionSheet:function(){0==this.isLogin?(0,u.toLogin)():(this.posters=!0,this.getPosterInfo())},listenerActionClose:function(){this.posters=!1},goFriend:function(){this.posters=!1},iptCartNum:function(t){this.$set(this.attr.productSelect,"cart_num",t),this.$set(this,"cart_num",t)},attrVal:function(t){this.attr.productAttr[t.indexw].index=this.attr.productAttr[t.indexw].attr_values[t.indexn]},onMyEvent:function(){this.$set(this.attr,"cartAttr",!1),this.$set(this,"isOpen",!1)},ChangeAttr:function(t){this.$set(this,"cart_num",1);var e=this.productValue[t];e?(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"quota",e.quota),this.$set(this.attr.productSelect,"unique",e.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"product_stock",e.product_stock),this.$set(this.attr.productSelect,"quota_show",e.quota_show),this.$set(this,"attrValue",t),this.$set(this,"attrTxt","已选择")):(this.$set(this.attr.productSelect,"image",this.storeCombination.image),this.$set(this.attr.productSelect,"price",this.storeCombination.price),this.$set(this.attr.productSelect,"quota",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"quota_show",0),this.$set(this.attr.productSelect,"product_stock",0),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(this.cart_num&&(e.cart_num=this.cart_num,this.attr.productSelect.cart_num=this.cart_num),void 0!==e||this.attr.productAttr.length||(e=this.attr.productSelect),void 0!==e){e.stock,e.quota_show;var i=e.quota||0,s=e.product_stock||0,o=this.attr.productSelect,n=this.storeCombination.num||0;if(void 0==e.cart_num&&(e.cart_num=1),t){o.cart_num++;var a=[];a.push(n),a.push(i),a.push(s);var r=Math.min.apply(null,a);o.cart_num>=r&&(this.$set(this.attr.productSelect,"cart_num",r||1),this.$set(this,"cart_num",r||1)),this.$set(this,"cart_num",o.cart_num),this.$set(this.attr.productSelect,"cart_num",o.cart_num)}else o.cart_num--,o.cart_num<1&&(this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"cart_num",1)),this.$set(this,"cart_num",o.cart_num),this.$set(this.attr.productSelect,"cart_num",o.cart_num)}},DefaultSelect:function(){var t=this.attr.productAttr,e=[];for(var i in this.productValue)if(this.productValue[i].quota>0){e=this.attr.productAttr.length?i.split(","):[];break}for(var s=0;s<t.length;s++)this.$set(t[s],"index",e[s]);var o=this.productValue[e.join(",")];o&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeCombination.title),this.$set(this.attr.productSelect,"image",o.image),this.$set(this.attr.productSelect,"price",o.price),this.$set(this.attr.productSelect,"quota",o.quota),this.$set(this.attr.productSelect,"unique",o.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"product_stock",o.product_stock),this.$set(this.attr.productSelect,"quota_show",o.quota_show),this.$set(this,"attrValue",e.join(",")),this.attrValue=e.join(","),this.$set(this,"attrTxt","已选择")):!o&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeCombination.title),this.$set(this.attr.productSelect,"image",this.storeCombination.image),this.$set(this.attr.productSelect,"price",this.storeCombination.price),this.$set(this.attr.productSelect,"quota",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"product_stock",0),this.$set(this.attr.productSelect,"quota_show",0),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择")):o||t.length||(this.$set(this.attr.productSelect,"store_name",this.storeCombination.title),this.$set(this.attr.productSelect,"image",this.storeCombination.image),this.$set(this.attr.productSelect,"price",this.storeCombination.price),this.$set(this.attr.productSelect,"quota",0),this.$set(this.attr.productSelect,"unique",this.storeCombination.unique||""),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"quota_show",0),this.$set(this.attr.productSelect,"product_stock",0),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},setProductSelect:function(){var t=this.attr;t.productSelect.image=this.storeCombination.image,t.productSelect.store_name=this.storeCombination.title,t.productSelect.price=this.storeCombination.price,t.productSelect.quota=0,t.productSelect.quota_show=0,t.productSelect.product_stock=0,t.cartAttr=!1,this.$set(this,"attr",t)},pay:function(){this.attr.cartAttr=!0,this.isOpen=!0},goPay:function(){var e=this,i={};i.productId=e.storeCombination.product_id,i.cartNum=e.attr.productSelect.cart_num,i.uniqueId=e.attr.productSelect.unique,i.combinationId=e.storeCombination.id,i.new=1,(0,l.postCartAdd)(i).then((function(i){t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+i.data.cartId+"&pinkId="+e.pinkId})})).catch((function(t){e.$util.Tips({title:t})}))},goOrder:function(){t.navigateTo({url:"/pages/goods/order_details/index?order_id="+this.currentPinkOrder})},goList:function(){t.navigateTo({url:"/pages/activity/goods_combination/index"})},goDetail:function(e){this.pinkId=e,t.navigateTo({url:"/pages/activity/goods_details/index?id="+e+"&type=3"})},getCombinationPink:function(){var e=this,i=this;(0,h.getCombinationPink)(i.pinkId).then((function(s){i.$set(i,"storeCombinationHost",s.data.store_combination_host),s.data.pinkT.stop_time=parseInt(s.data.pinkT.stop_time);var o=Date.parse(new Date)/1e3;if(i.endTime=parseInt(o)>s.data.pinkT.stop_time,i.$set(i,"storeCombination",s.data.store_combination),i.$set(i.attr.productSelect,"num",s.data.store_combination.num),i.$set(i,"pinkT",s.data.pinkT),i.$set(i,"pinkAll",s.data.pinkAll),i.$set(i,"count",s.data.count),i.$set(i,"userBool",s.data.userBool),i.$set(i,"pinkBool",s.data.pinkBool),i.$set(i,"isOk",s.data.is_ok),i.$set(i,"currentPinkOrder",s.data.current_pink_order),i.$set(i,"userInfo",s.data.userInfo),f.globalData.openPages="/pages/activity/goods_combination_status/index?id="+e.pinkId,i.attr.productAttr=s.data.store_combination.productAttr,i.productValue=s.data.store_combination.productValue,i.setProductSelect(),0!=i.attr.productAttr&&i.DefaultSelect(),1==s.data.is_ok&&0==s.data.userBool)return e.$util.Tips({title:"你不是该团的成员"},(function(){t.navigateTo({url:"/pages/activity/goods_combination/index"})}))})).catch((function(i){return e.$util.Tips({title:i},(function(){t.navigateBack()}))}))},getCombinationRemove:function(){var t=this;(0,h.postCombinationRemove)({id:t.pinkId,cid:t.storeCombination.id}).then((function(e){t.$util.Tips({title:e.msg},{tab:3})})).catch((function(e){t.$util.Tips({title:e})}))},lookAll:function(){this.iShidden=!this.iShidden},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilestoreImage:function(e){var i=this;return e=this.setDomain(e),new Promise((function(s,o){var n=i;t.downloadFile({url:e,success:function(t){s(t.tempFilePath)},fail:function(){return n.$util.Tips({title:""})}})}))},getPosterInfo:function(){var t=this;return(0,n.default)(o.default.mark((function e(){var i,s;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.from="routine",i=t,"",{id:i.id,from:i.from},s=JSON.parse(t.$Cache.get("USER_INFO")),i.$set(i,"canvasStatus",!0),(0,h.getCombinationPosterData)(t.pinkId).then(function(){var e=(0,n.default)(o.default.mark((function e(n){var a,r,c,u,d,h,l,p,m,g;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=n.data,r=a,e.next=4,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/posterBagInner.png");case 4:return u=e.sent,e.next=7,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/posterBag.png");case 7:return d=e.sent,e.next=10,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/postertag.png");case 10:return h=e.sent,e.next=13,t.downloadFilestoreImage(r.image);case 13:return l=e.sent,e.next=16,t.downloadFilestoreImage(s.avatar);case 16:return p=e.sent,e.next=19,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/rmb.png");case 19:return m=e.sent,e.next=22,t.downloadFilestoreImage(r.url);case 22:g=e.sent,c=[d,l,g,u,h,p,m],t.$nextTick((function(){t.$util.bargainPosterCanvas(c,r.title,r.label,r.msg,r.price,s,"拼团",(function(e){t.posterImage=e,t.posterImageStatus=!0,i.$set(i,"canvasStatus",!1)}))}));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return t.$util.Tips({title:e})}));case 6:case"end":return e.stop()}}),e)})))()},getpreviewImage:function(){if(this.posterImage){var e=[];e.push(this.posterImage),t.previewImage({urls:e,current:this.posterImage})}else this.$util.Tips({title:"您的海报尚未生成"})},posterImageClose:function(){this.posterImageStatus=!1,this.posters=!1},savePosterPath:function(){var e=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})}})}})}}};e.default=_}).call(this,i("df3c")["default"])}},[["96a5","common/runtime","common/vendor"]]]);