(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/goods_bargain_details/index"],{"18b0":function(t,a,i){"use strict";(function(t){var n=i("47a9");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=n(i("7eb4")),s=n(i("ee10")),r=n(i("3b2d")),o=i("b0fe"),u=i("0f73"),c=n(i("1e56")),g=i("5088"),d=i("8f59"),l=(i("c4d7"),i("4d38")),f=n(i("89cc")),p=t.getWindowInfo().statusBarHeight,h=getApp(),b={components:{baseDrawer:function(){i.e("components/tui-drawer/tui-drawer").then(function(){return resolve(i("af01"))}.bind(null,i)).catch(i.oe)},countDown:function(){i.e("components/countDown/index").then(function(){return resolve(i("1706"))}.bind(null,i)).catch(i.oe)},NavBar:function(){i.e("components/NavBar").then(function(){return resolve(i("a7d8"))}.bind(null,i)).catch(i.oe)}},mixins:[f.default],data:function(){return{sysHeight:p,showSkeleton:!0,isNodes:0,countDownDay:"00",countDownHour:"00",countDownMinute:"00",countDownSecond:"00",active:!1,id:0,userInfo:{},bargainUid:0,bargainUserInfo:{},bargainUserId:0,bargainInfo:{brand_name:""},offset:0,limit:20,limitStatus:!1,bargainUserHelpList:[],bargainUserHelpInfo:[],bargainUserBargainPrice:0,status:"",bargainCount:[],retunTop:!0,bargainPartake:0,isHelp:!1,interval:null,userBargainStatus:0,bargainSumCount:0,productStock:0,quota:0,userBargainStatusHelp:!0,navH:"",statusPay:"",bargainPrice:0,datatime:0,offest:"",tagStyle:{img:"width:100%;display:block;",table:"width:100%",video:"width:100%"},H5ShareBox:!1,systemH:100,isAuto:!1,isShowAuth:!1,posters:!1,weixinStatus:!1,couponsHidden:!0,followCode:!1,codeShow:!1,cid:"1",ifShow:!0,val:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",icon:"",iconsize:40,lv:3,onval:!0,loadMake:!0,src:"",codeSrc:"",picUrl:{},payCount:0,endTimes:0,imgHost:l.HTTP_REQUEST_URL,supportBg:l.HTTP_REQUEST_URL+"/statics/images/bargain/bargain-support.png",bargaBg:l.HTTP_REQUEST_URL+"/statics/images/bargain/bargain-con.png",countdownBg:l.HTTP_REQUEST_URL+"/statics/images/bargain/bargain-countdown-bg.png",knife:l.HTTP_REQUEST_URL+"/statics/images/bargain/bargain-knife.png",bargainTitle:l.HTTP_REQUEST_URL+"/statics/images/bargain/bargain-title-bg.png",bargainPop:l.HTTP_REQUEST_URL+"/statics/images/bargain/bargain-pop.jpg",showDrawer:!1,posterImageStatus:!1,posterImage:"",canvasStatus:!1}},computed:(0,d.mapGetters)(["isLogin","uid"]),watch:{isLogin:{handler:function(t,a){},deep:!0}},onPageScroll:function(a){t.$emit("scroll")},onLoad:function(a){this.colorData();var i=this;t.getSystemInfo({success:function(t){i.systemH=t.statusBarHeight,i.navH=i.systemH+10}});var n=getCurrentPages();if(n.length<=1&&(i.retunTop=!1),a.scene){var e=c.default.getUrlParams(decodeURIComponent(a.scene));"object"===(0,r.default)(e)?(e.id&&(a.id=e.id),e.spid&&(a.spid=e.spid)):h.globalData.spid=e}a.hasOwnProperty("id")&&(i.id=a.id,i.bargainUid=a.spid||0,a.spid&&(h.globalData.spid=a.spid)),this.isLogin?("undefined"!=i.bargainUid&&i.bargainUid||(i.bargainUid=i.$store.state.app.uid),this.addShareBargain(),this.getBargainDetails()):(this.$Cache.set("login_back_url","/pages/activity/goods_bargain_details/index?id=".concat(a.id,"&spid=").concat(this.bargainUid)),this.getIsLogin()),t.setNavigationBarTitle({title:"砍价详情"})},methods:{endTime:function(t){this.endTimes=t},getIsLogin:function(){(0,g.toLogin)()},listenerActionSheet:function(){0==this.isLogin?this.getIsLogin():this.posters=!0},getBargainUserBargainPricePoster:function(){0==this.isLogin?(0,g.toLogin)():(this.active=!1,this.posters=!0,this.getPosterInfo())},listenerActionClose:function(){this.posters=!1},qrR:function(t){this.codeSrc=t},goFriend:function(){this.posters=!1},openTap:function(){this.$set(this,"couponsHidden",!this.couponsHidden)},authColse:function(t){this.isShowAuth=t},goProduct:function(){t.navigateTo({url:"/pages/goods_details/index?id=".concat(this.bargainInfo.product_id)})},userBargain:function(){if(this.userInfo.uid==this.bargainUid){if(this.userBargainStatus==this.bargainInfo.num)return this.$util.Tips({title:"该商品每人限购".concat(this.bargainInfo.num).concat(this.bargainInfo.unit_name)});this.setBargain()}},goBack:function(){t.navigateBack()},gobargainUserInfo:function(){var t=this;t.bargainUid;(0,o.postBargainStartUser)({bargainId:t.id,bargainUserUid:t.bargainUid}).then((function(a){t.$set(t,"bargainUserInfo",a.data)}))},goPay:function(){var a=this,i={productId:a.bargainInfo.product_id,bargainId:a.id,cartNum:1,uniqueId:"",combinationId:0,secKillId:0,new:1};(0,u.postCartAdd)(i).then((function(a){t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+a.data.cartId})})).catch((function(t){return a.$util.Tips({title:t})}))},getBargainDetails:function(){var a=this,i=a.id;(0,o.getBargainDetail)(i).then((function(i){a.payCount=i.data.payCount,a.bargainInfo=i.data.bargain,a.bargainInfo.description&&(a.bargainInfo.description=a.bargainInfo.description.replace(/<img/gi,'<img style="max-width:100%;height:auto;float:left;display:block" '),a.bargainInfo.description=a.bargainInfo.description.replace(/<video/gi,'<video style="width:100%;height:auto;display:block" ')),a.bargainPrice=i.data.bargain.price,a.userInfo=i.data.userInfo,a.bargainSumCount=i.data.bargainSumCount,a.userBargainStatus=i.data.userBargainStatus,a.productStock=i.data.bargain.attr.product_stock,a.quota=i.data.bargain.attr.quota,a.datatime=i.data.bargain.stop_time,t.setNavigationBarTitle({title:i.data.bargain.title.substring(0,13)+"..."}),a.bargainUserHelpList=[],a.isLogin&&(a.getBargainHelpCount(),a.getBargainUser(),a.gobargainUserInfo()),setTimeout((function(){a.showSkeleton=!1}),300)})).catch((function(t){a.$util.Tips({title:t},{tab:2,url:"/pages/activity/goods_bargain/index"})}))},getBargainHelpCount:function(){var t=this,a={bargainId:t.id,bargainUserUid:t.bargainUid};(0,o.postBargainHelpCount)(a).then((function(a){var i=c.default.$h.Sub(t.bargainPrice,a.data.alreadyPrice);t.bargainUserHelpInfo=a.data,t.bargainInfo.price=parseFloat(i)<=0?0:i,t.userBargainStatusHelp=a.data.userBargainStatus,t.statusPay=a.data.status}))},currentBargainUser:function(){this.$set(this,"bargainUid",this.userInfo.uid),this.setBargain()},setBargain:function(){var t=this,a=this;(0,o.postBargainStart)(a.id).then((function(i){if("subscribe"===i.data.code)return a.$set(a,"followCode",!0),void(t.codeSrc=i.data.url);a.$set(a,"bargainUserId",i.data),a.getBargainUserBargainPrice(),a.setBargainHelp(),a.getBargainHelpCount(),a.userBargainStatus=1})).catch((function(t){a.$util.Tips({title:t})}))},setBargainHelp:function(){var t=this,a=this,i={bargainId:a.id,bargainUserUid:a.bargainUid};(0,o.postBargainHelp)(i).then((function(i){if("subscribe"===i.data.code)return a.$set(a,"followCode",!0),void(t.codeSrc=i.data.url);a.$set(a,"bargainUserHelpList",[]),a.$set(a,"isHelp",!0),a.getBargainUser(),a.getBargainUserBargainPrice(),a.getBargainHelpCount()})).catch((function(t){a.$util.Tips({title:t}),a.$set(a,"bargainUserHelpList",[]),a.getBargainUser()}))},getBargainUser:function(){var t=this,a={bargainId:t.id,bargainUserUid:t.bargainUid,offset:t.offset,limit:t.limit};(0,o.postBargainHelpList)(a).then((function(i){var n=t.bargainUserHelpList,e=i.data.length;n.concat(i.data),t.$set(t,"bargainUserHelpList",i.data),t.$set(t,"limitStatus",a.limit>e),t.$set(t,"offest",Number(a.offset)+Number(a.limit))}))},getBargainUserBargainPrice:function(){var t=this,a={bargainId:t.id,bargainUserUid:t.bargainUid};(0,o.postBargainHelpPrice)(a).then((function(a){t.$set(t,"bargainUserBargainPrice",a.data),t.$set(t,"active",!0)})).catch((function(a){t.$set(t,"active",!1)}))},goBargainList:function(){t.navigateTo({url:"/pages/activity/goods_bargain/index"})},goIndex:function(){t.switchTab({url:"/pages/index/index"})},close:function(){this.$set(this,"active",!1)},onLoadFun:function(t){"undefined"!=this.bargainUid&&this.bargainUid||(this.bargainUid=this.$store.state.app.uid),this.getBargainDetails(),this.addShareBargain(),this.isShowAuth=!1},addShareBargain:function(){var t=this;(0,o.postBargainShare)(this.id).then((function(a){t.$set(t,"bargainCount",a.data)}))},closeDrawer:function(){this.showDrawer=!1},goRecord:function(){t.navigateTo({url:"/pages/activity/bargain/index"})},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilestoreImage:function(a){var i=this;return a=this.setDomain(a),new Promise((function(n,e){var s=i;t.downloadFile({url:a,success:function(t){n(t.tempFilePath)},fail:function(){return s.$util.Tips({title:""})}})}))},getPosterInfo:function(){var t=this;return(0,s.default)(e.default.mark((function a(){var i,n;return e.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.from="routine",i=t,"",{id:i.id,from:i.from},n=JSON.parse(t.$Cache.get("USER_INFO")),i.$set(i,"canvasStatus",!0),(0,o.getBargainPosterData)(t.id).then(function(){var a=(0,s.default)(e.default.mark((function a(s){var r,o,u,c,g,d,l,f,p,h;return e.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=s.data,o=r,a.next=4,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/posterBagInner.png");case 4:return c=a.sent,a.next=7,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/posterBag2.png");case 7:return g=a.sent,a.next=10,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/postertag2.png");case 10:return d=a.sent,a.next=13,t.downloadFilestoreImage(n.avatar);case 13:return l=a.sent,a.next=16,t.downloadFilestoreImage(o.image);case 16:return f=a.sent,a.next=19,t.downloadFilestoreImage(t.imgHost+"/statics/images/activity/rmb.png");case 19:return p=a.sent,a.next=22,t.downloadFilestoreImage(o.url);case 22:h=a.sent,u=[g,f,h,c,d,l,p],t.$nextTick((function(){t.$util.bargainPosterCanvas(u,o.title,o.label,o.msg,o.price,n,"砍价",(function(a){t.posterImage=a,t.posterImageStatus=!0,i.$set(i,"canvasStatus",!1)}))}));case 25:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}()).catch((function(a){t.$util.Tips({title:a},"/pages/activity/goods_bargain/index")}));case 6:case"end":return a.stop()}}),a)})))()},getpreviewImage:function(){if(this.posterImage){var a=[];a.push(this.posterImage),t.previewImage({urls:a,current:this.posterImage})}else this.$util.Tips({title:"您的海报尚未生成"})},posterImageClose:function(){this.posterImageStatus=!1,this.posters=!1},savePosterPath:function(){var a=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:a.posterImage,success:function(t){a.posterImageClose(),a.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){a.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:a.posterImage,success:function(t){a.posterImageClose(),a.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){a.$util.Tips({title:"保存失败"})}})}})}})}},onReady:function(){this.isNodes++},onShow:function(){t.removeStorageSync("form_type_cart")},onHide:function(){null!==this.interval&&clearInterval(this.interval)},onUnload:function(){null!==this.interval&&clearInterval(this.interval)},onShareAppMessage:function(){var t={title:"您的好友"+this.userInfo.nickname+"邀请您帮他砍"+this.bargainInfo.title+" 快去帮忙吧！",path:"/pages/activity/goods_bargain_details/index?id="+this.id+"&spid="+this.bargainUid,imageUrl:this.bargainInfo.image};return this.close(),this.addShareBargain(),t},onShareTimeline:function(){return this.close(),this.addShareBargain(),{title:"您的好友"+this.userInfo.nickname+"邀请您帮他砍"+this.bargainInfo.title+" 快去帮忙吧！",path:"/pages/activity/goods_bargain_details/index?id="+this.id+"&spid="+this.bargainUid,imageUrl:this.bargainInfo.image}}};a.default=b}).call(this,i("df3c")["default"])},"304c":function(t,a,i){"use strict";i.r(a);var n=i("56e7"),e=i("3753");for(var s in e)["default"].indexOf(s)<0&&function(t){i.d(a,t,(function(){return e[t]}))}(s);i("faa8");var r=i("828b"),o=Object(r["a"])(e["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);a["default"]=o.exports},3753:function(t,a,i){"use strict";i.r(a);var n=i("18b0"),e=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(a,t,(function(){return n[t]}))}(s);a["default"]=e.a},4882:function(t,a,i){"use strict";(function(t,a){var n=i("47a9");i("f076");n(i("3240"));var e=n(i("304c"));t.__webpack_require_UNI_MP_PLUGIN__=i,a(e.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"56e7":function(t,a,i){"use strict";i.d(a,"b",(function(){return e})),i.d(a,"c",(function(){return s})),i.d(a,"a",(function(){return n}));var n={easyLoadimage:function(){return i.e("components/easy-loadimage/easy-loadimage").then(i.bind(null,"94dd"))}},e=function(){var t=this,a=t.$createElement,i=(t._self._c,t.bargainUserHelpList.length),n=i?t.bargainUserHelpList.length:null,e=i?t.bargainUserHelpList.length:null;t._isMounted||(t.e0=function(a){t.showDrawer=!0},t.e1=function(a){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{g0:i,g1:n,g2:e}})},s=[]},"94be":function(t,a,i){},faa8:function(t,a,i){"use strict";var n=i("94be"),e=i.n(n);e.a}},[["4882","common/runtime","common/vendor"]]]);